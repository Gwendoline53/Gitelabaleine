{% extends 'base.html.twig' %}

{% block title %}Contacts{% endblock %}

{% block body %}
{% include 'navbar/index.html.twig' %}
{% if mode_edition|default(false) %}
<div class="locale-selector">
    <a href="{{ path('admin_contact', {locale: 'fr'}) }}">Fran√ßais</a> | 
    <a href="{{ path('admin_contact', {locale: 'En'}) }}">English</a>
</div>
{% endif %}
<div class="contact-container">
  <h1 class="contact-title elegant-underline"
      contenteditable="{{ mode_edition|default(false) ? 'true' : 'false' }}"
      id="titre"
      data-cle="titre">
    {{ contact.titre|default('Contacts') }}
  </h1>
  <!-- Le reste du contenu -->
</div>

<main class="contact-wrapper">

    <div class="image-container gauche">
        <div class="decorative-imagecontactgauche" alt="D√©coration-gauche"></div>
    </div>

    <div class="contact-container">
        <div class="contact-content">
            

            {# Donn√©es de contact #}
            {% set contenus = contenus|default({
                'email': contact.email|default('info@exemple-conciergerie.fr'),
                'telephone': contact.telephone|default('+ 06 00 00 00 00 00'),
                'adresse': contact.adresse|default('La exemple, Le exemple 5000')
            }) %}

            <div class="contact-info">
                <div class="contact-item">
                    <div class="contact-icon">‚úâ</div>
                    <div contenteditable="{{ mode_edition|default(false) ? 'true' : 'false' }}" id="email" data-cle="email">{{ contenus.email }}</div>
                </div>

                <div class="contact-item">
                    <div class="contact-icon">‚òé</div>
                    <div contenteditable="{{ mode_edition|default(false) ? 'true' : 'false' }}" id="telephone" data-cle="telephone">{{ contenus.telephone }}</div>
                </div>

                <div class="contact-item">
                    <div class="contact-icon">üìç</div>
                    <div contenteditable="{{ mode_edition|default(false) ? 'true' : 'false' }}" id="adresse" data-cle="adresse">{{ contenus.adresse }}</div>
                </div>
            </div>

            <button class="contact-button" onclick="window.location.href='{{ path('app_formulaire') }}'">Nous contacter</button>
        </div>
    </div>

    <div class="image-container droite">
        <div class="decorative-imagecontactdroite" alt="D√©coration-droite"></div>
    </div>

</main>

{% if mode_edition|default(false) %}
<div class="btn-containervalidercontact">
  <button id="btn-validercontact">Valider les modifications</button>
</div>
<script>
  // Envoi automatique au blur
  document.querySelectorAll('[contenteditable="true"]').forEach(el => {
      el.addEventListener('blur', () => {
          const cle = el.dataset.cle;
          const texte = el.innerText.trim();
          const locale = '{{ locale|default('fr') }}';

          fetch('{{ path("admin_contact_update") }}', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({cle: cle, texte: texte, locale: locale})
          })
          .then(response => response.json())
          .then(data => {
              if (!data.success) {
                  alert('Erreur lors de la sauvegarde');
              }
          });
      });
  });

  document.getElementById('btn-validercontact').addEventListener('click', () => {
    window.location.href = '{{ path('admin_gestion') }}';
  });
</script>
{% endif %}
{% include 'footer/index.html.twig' %}
{% endblock %}
