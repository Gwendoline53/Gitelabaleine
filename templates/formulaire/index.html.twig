{% extends 'base.html.twig' %}

{% block title %}{{ contenus.meta_titre|default('Nous contacter') }}{% endblock %}

{% block body %}
{% include 'navbar/index.html.twig' %}
{% if mode_edition|default(false) %}
<div class="formulairelocale-selector">
    <a href="{{ path('admin_formulaire', {locale: 'fr'}) }}" class="{{ locale == 'fr' ? 'active' : '' }}">Fran√ßais</a> | 
    <a href="{{ path('admin_formulaire', {locale: 'en'}) }}" class="{{ locale == 'en' ? 'active' : '' }}">English</a>
</div>
{% endif %}
<div class="v1">

    <div class="image-containerformulairegauche">
        <div class="decorative-imageformulairegauche" alt="D√©coration-gauche"></div>
    </div>
    <div class="image-containerformulairedroite">
        <div class="decorative-imageformulairedroite" alt="D√©coration-droite"></div>
    </div>
    <div class="image-containerformulairedroite2">
        <div class="decorative-imageformulairedroite2" alt="D√©coration-droite"></div>
    </div>
    <div class="image-containerformulaire3">
        <div class="decorative-imageformulaire3" alt="D√©coration-droite"></div>
    </div>

    <h1 class="titreformulaireformulaire"
        {% if mode_edition %}contenteditable="true" data-cle="titre"{% endif %}>
        {{ contenus.titre|default('Nous Contacter')|raw }}
    </h1>

    <div class="containerformulaire">

        {% for label, messages in app.flashes %}
            <div class="alert alert-{{ label }}">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
        {% endfor %}

        {{ form_start(form, {'attr': {'class': 'formulaire-form'}}) }}

        <div class="input-group">
            <div class="icon">‚úâÔ∏è</div>
            <div class="nousformulairedark-light">
                {{ form_widget(form.fromEmail, {
                    'attr': {
                        'placeholder': contenus.placeholder_email|default('Entrez votre adresse mail...'),
                        'required': true
                    }
                }) }}
                {{ form_errors(form.fromEmail) }}
            </div>
        </div>

        <div class="input-group">
            <div class="icon">üìû</div>
            {{ form_widget(form.phoneNumber, {
                'attr': {
                    'placeholder': contenus.placeholder_telephone|default('Entrez votre num√©ro de t√©l√©phone...'),
                    'required': false
                }
            }) }}
            {{ form_errors(form.phoneNumber) }}
        </div>

        <div class="input-group">
            {{ form_widget(form.subject, {'attr': {'class': 'styled-select', 'required': true}}) }}
            {{ form_errors(form.subject) }}
        </div>

        <div class="input-group" id="chambre-group" style="display:none;">
            {{ form_label(form.chambre) }}
            {{ form_widget(form.chambre, {'attr': {'class': 'styled-select'}}) }}
            {{ form_errors(form.chambre) }}
        </div>

        <div class="textarea-group">
            {{ form_widget(form.body, {
                'attr': {
                    'placeholder': contenus.placeholder_message|default('Entrez votre message ici...'),
                    'rows': 8,
                    'required': true,
                }
            }) }}
            {{ form_errors(form.body) }}
        </div>

        <button class="formulairebutton" type="submit">
            {{ contenus.bouton|default('Envoyer')|raw }}
        </button>

        {{ form_end(form) }}

    </div>
</div>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
            const subjectSelect = document.querySelector('select[name="{{ form.subject.vars.full_name }}"]');
            const chambreGroup = document.getElementById('chambre-group');

            if (!subjectSelect || !chambreGroup) {
                console.warn("Champ 'subject' ou 'chambre-group' introuvable.");
                return;
            }

            function toggleChambre() {
                console.log("Valeur s√©lectionn√©e :", subjectSelect.value);
                if (subjectSelect.value === 'reservation') {
                    chambreGroup.style.display = 'block';
                } else {
                    chambreGroup.style.display = 'none';
                }
            }

            subjectSelect.addEventListener('change', toggleChambre);
            toggleChambre();
        });
    </script>
{% if mode_edition|default(false) %}
<div class="btn-containervaliderformulaire">
    <button id="btn-validerformulaire">Valider les modifications</button>
</div>

<script>
    document.querySelectorAll('[contenteditable="true"]').forEach(el => {
        el.addEventListener('blur', () => {
            const cle = el.dataset.cle;
            const texte = el.innerHTML.trim();
            const locale = '{{ locale|default("fr") }}';

            fetch('{{ path("admin_update_contenu") }}', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cle: cle, texte: texte, locale: locale })
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    alert("Erreur lors de la sauvegarde");
                }
            });
        });
    });

    document.getElementById('btn-validerformulaire').addEventListener('click', () => {
        window.location.href = '{{ path("admin_gestion") }}';
    });
</script>
{% endif %}

{% include 'footer/index.html.twig' %}
{% endblock %}
